{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BooksTrack â€” Market Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'dashboard.css' %}">
</head>
<body>

<!-- MOBILE TOP BAR -->
<div class="mobile-topbar">
    <button class="hamburger" id="hamburgerBtn" aria-label="Open menu">
        <span></span><span></span><span></span>
    </button>
    <div class="mobile-brand">
        <div class="brand-icon">B</div>
        <span class="brand-name">BookTrack</span>
    </div>
    <a href="/logout/" class="mobile-logout" onclick="return confirm('Log out of BookTrack?')" title="Logout">
        <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
            <polyline points="16 17 21 12 16 7"/>
            <line x1="21" y1="12" x2="9" y2="12"/>
        </svg>
    </a>
</div>

<div class="sidebar-overlay" id="sidebarOverlay"></div>

<!-- SIDEBAR -->
<aside class="sidebar" id="sidebar">
    <div class="sidebar-brand">
        <div class="brand-icon">B</div>
        <div>
            <div class="brand-name">Books Track</div>
            <div class="brand-sub">Market Intelligence</div>
        </div>
        <button class="sidebar-close" id="sidebarClose" aria-label="Close menu">
            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
        </button>
    </div>
    <nav class="sidebar-nav">
        <div class="nav-section-label">Overview</div>
        <a class="nav-item active" href="#" data-panel="dashboard">
            <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/>
                <rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/>
            </svg>
            Dashboard
        </a>
        <a class="nav-item" href="#" data-panel="books">
            <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
            </svg>
            Books
        </a>
        <a class="nav-item" href="#" data-panel="analytics">
            <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <line x1="18" y1="20" x2="18" y2="10"/>
                <line x1="12" y1="20" x2="12" y2="4"/>
                <line x1="6" y1="20" x2="6" y2="14"/>
            </svg>
            Analytics
        </a>
        <div class="nav-section-label" style="margin-top:20px">Quick Actions</div>
        <a class="nav-item" href="#" id="interestedNavBtn" data-panel="dashboard" onclick="document.getElementById('showInterested').checked=true;applyFilters();return false;">
            <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24">
                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
            </svg>
            Interested
            <span class="nav-badge" id="interestedCount" style="display:none">0</span>
        </a>
    </nav>
    <div class="sidebar-footer">
        <div class="user-avatar">{{ request.user.username|first|upper }}</div>
        <div class="user-info">
            <div class="user-name">{{ request.user.username }}</div>
            <div class="user-role">Administrator</div>
        </div>
        <a href="/logout/" class="logout-btn" title="Logout" onclick="return confirm('Log out of BookTrack?')">
            <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                <polyline points="16 17 21 12 16 7"/>
                <line x1="21" y1="12" x2="9" y2="12"/>
            </svg>
        </a>
    </div>
</aside>

<!-- MAIN CONTENT -->
<main class="main-content">
    <header class="topbar">
        <div>
            <h1 class="page-title" id="pageTitle">Market Dashboard</h1>
            <p class="page-subtitle" id="pageSubtitle">Real-time book market intelligence</p>
        </div>
        <div class="topbar-right">
            <div class="live-badge"><span class="live-dot"></span>Live</div>
            <div class="date-chip" id="currentDate"></div>
        </div>
    </header>

    <!-- PANEL: DASHBOARD -->
    <div id="panel-dashboard" class="panel active">

        <!-- Stats -->
        <section class="stats-grid" id="statsContainer">
            <div class="stat-skeleton"></div><div class="stat-skeleton"></div>
            <div class="stat-skeleton"></div><div class="stat-skeleton"></div>
            <div class="stat-skeleton"></div><div class="stat-skeleton"></div>
        </section>

        <!-- Filters -->
        <section class="filter-panel">
            <div class="filter-panel-header">
                <span class="filter-panel-title">
                    <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/>
                    </svg>
                    Filters
                </span>
                <button class="btn-reset" id="resetFiltersBtn">Reset all</button>
            </div>

            <div class="filter-grid">
                <!-- Marketplace -->
                <div class="filter-group filter-group--marketplace">
                    <label class="filter-label">Marketplace</label>
                    <div id="marketplaceContainer" class="marketplace-container"></div>
                    <input type="hidden" id="marketplace" value="">
                </div>

                <!-- Price Range -->
                <div class="filter-group">
                    <label class="filter-label">Price Range</label>
                    <div class="price-range-row">
                        <div class="price-input-wrap">
                            <span class="price-symbol">â‚¬</span>
                            <input type="number" class="price-input" id="minPrice" placeholder="Min" min="0">
                        </div>
                        <span class="price-sep">â€”</span>
                        <div class="price-input-wrap">
                            <span class="price-symbol">â‚¬</span>
                            <input type="number" class="price-input" id="maxPrice" placeholder="Max" min="0">
                        </div>
                    </div>
                </div>

                <!-- Time Window -->
                <div class="filter-group">
                    <label class="filter-label">Time Window</label>
                    <div id="daysFilter" class="days-filter">
                        <button class="day-btn" data-days="1">Today</button>
                        <button class="day-btn" data-days="7">7d</button>
                        <button class="day-btn" data-days="15">15d</button>
                        <button class="day-btn active" data-days="30">30d</button>
                        <button class="day-btn" data-days="all">All</button>
                    </div>
                    <input type="hidden" id="daysOld" value="30">
                </div>

                <!-- Condition -->
                <div class="filter-group">
                    <label class="filter-label">Condition</label>
                    <select class="filter-select" id="condition">
                        <option value="">All Conditions</option>
                    </select>
                </div>

                <!-- Group By -->
                <div class="filter-group">
                    <label class="filter-label">Group By</label>
                    <select class="filter-select" id="groupBy">
                        <option value="isbn">ISBN</option>
                        <option value="seller">Seller</option>
                    </select>
                </div>

                <!-- Interest Filter -->
                <div class="filter-group filter-group--toggle">
                    <label class="filter-label">Interest Filter</label>
                    <div class="interest-filter-group">
                        <label class="toggle-switch">
                            <input type="checkbox" id="showInterested">
                            <span class="toggle-track"><span class="toggle-thumb"></span></span>
                            <span class="toggle-label">â˜… Interested only</span>
                        </label>
                        <label class="toggle-switch" style="margin-top:6px">
                            <input type="checkbox" id="hideNotInterested">
                            <span class="toggle-track"><span class="toggle-thumb"></span></span>
                            <span class="toggle-label">âœ• Hide dismissed</span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="filter-actions">
                <button class="btn-apply" id="applyFiltersBtn">
                    Apply Filters
                    <svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24">
                        <line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/>
                    </svg>
                </button>
            </div>
        </section>

        <!-- Results -->
        <section class="results-section">
            <div class="results-header">
                <h2 class="results-title">Results</h2>
                <span class="results-count" id="resultsCount"></span>
            </div>
            <div id="resultsContainer">
                <div class="results-empty">
                    <div class="spinner"></div>
                    <span>Loading resultsâ€¦</span>
                </div>
            </div>
        </section>
    </div>

    <!-- PANEL: BOOKS -->
    <div id="panel-books" class="panel">
        <div class="info-panel">
            <div class="info-panel-icon">ðŸ“š</div>
            <h2 class="info-panel-title">Books Explorer</h2>
            <p class="info-panel-desc">
                Browse all tracked books from every marketplace.<br>
                Use the Dashboard filters to narrow down results.
            </p>
            <div class="info-tip">
                <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="12" y1="8" x2="12" y2="12"/>
                    <line x1="12" y1="16" x2="12.01" y2="16"/>
                </svg>
                Full book browser coming soon. Use <em>Dashboard â†’ Apply Filters</em> to explore listings.
            </div>
            <button class="btn-apply" onclick="switchPanel('dashboard')" style="margin-top:24px">
                Go to Dashboard
                <svg width="13" height="13" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24">
                    <line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/>
                </svg>
            </button>
        </div>
    </div>

    <!-- PANEL: ANALYTICS -->
    <div id="panel-analytics" class="panel">
        <div class="analytics-grid" id="analyticsContent">
            <div class="analytics-loading">
                <div class="spinner"></div>
                <span>Loading analyticsâ€¦</span>
            </div>
        </div>
    </div>
</main>
<script type="module" src="{% static 'js/dashboard.js' %}"></script>

</body>
</html>